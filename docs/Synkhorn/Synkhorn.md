# Эксперименты с процессом Синкхорна

## Зависимость итераций от размера матрицы

Рассмотрим квадратные матрицы размером от 2 до 10 и элементами в диапазоне `[0.5, 2]`. Проведем эксперимент и посмотрим, сколько в среднем итераций потребуется, чтобы получить дважды стохастическую матрицу с точностью до пятого знака после запятой.

Предварительно можно предположить, что зависимость будет по типу "чем больше размер, тем больше итераций". Посмотрим, так ли это.

```console
$ ./LinearAlgebra
Sizes experiments: 
SIZE 2: ~3.4367 iterations
SIZE 3: ~3.996 iterations
SIZE 3: ~4.0048 iterations
SIZE 4: ~4.0154 iterations
SIZE 5: ~3.9479 iterations
SIZE 6: ~3.8854 iterations
SIZE 7: ~3.8219 iterations
SIZE 8: ~3.7659 iterations
SIZE 9: ~3.6739 iterations
SIZE 10: ~3.5721 iterations

...

```

Видим, что предположение оказалось неверным. На размерах `1-4` мы видим рост по количеству итераций, а потом их количество стабильно падает. Удостоверимся, что мы не попали на уникальный результат и повторно запустим эксперимент:

```console
Sizes experiments: 
SIZE 2: ~3.4304 iterations
SIZE 3: ~3.9824 iterations
SIZE 3: ~3.9864 iterations
SIZE 4: ~4.0061 iterations
SIZE 5: ~3.9557 iterations
SIZE 6: ~3.891 iterations
SIZE 7: ~3.8259 iterations
SIZE 8: ~3.7591 iterations
SIZE 9: ~3.6729 iterations
SIZE 10: ~3.5772 iterations

...

```
Если мы еще много раз запустим процесс, то заметим, что эффект остается.


Получается с ростом размера матрицы среднее количество итераций падает. Однако стоит учесть, что хоть в среднем итераций становится меньше, на самом деле реального времени, затраченного на исполнение, становится больше, так как мы вынуждены перемножать матрицы большего размера.

## Неотрицательные матрицы

### Сходимость

Рассмотрим матрицу размером 5. Посмотрим на зависимость количества итераций от количества нулевых элементов. Остальные элементы будут случайно выбраны в диапазоне `[0.01, 5]`.

```console
...

Non-negative experiments: 
ZEROS 1, SIZE 5: ~7.409 iterations
ZEROS 2, SIZE 5: ~8.529 iterations
ZEROS 3, SIZE 5: ~10.004 iterations
ZEROS 4, SIZE 5: ~11.289 iterations
ZEROS 5, SIZE 5: ~1453.52 iterations
ZEROS 6, SIZE 5: ~3315.65 iterations
ZEROS 7, SIZE 5: ~6477.52 iterations

...

```

Отметим, что процесс сходится, что уже радует. Однако мы видим очень сильный скачок, когда количество нулей становится равным количеству строк/столбцов матрицы. Причем дальше количество итераций продолжает сильно расти. Посмотрим, что будет при повторном запуске.

```console
...

Non-negative experiments: 
ZEROS 1, SIZE 5: ~7.381 iterations
ZEROS 2, SIZE 5: ~8.527 iterations
ZEROS 3, SIZE 5: ~9.837 iterations
ZEROS 4, SIZE 5: ~171.63 iterations
ZEROS 5, SIZE 5: ~1213.21 iterations
ZEROS 6, SIZE 5: ~3395.26 iterations
ZEROS 7, SIZE 5: ~6917.05 iterations

...
```

Видим, что скачок появляется уже на 4 нулях, что говорит о том, что у нас довольно большая дисперсия (по сравнению, например, с первым экспериментом). Селдовательно делаем вывод, что чем больше мы увеличиваем количество нулей, тем хуже сходится процесс, а если количество стало больше, чем размер матрицы, то количество итераций начинает очень резко вырастать.

### А что с другими размерами?

Повторим эксперимент для бОльших размеров.

```console
...

Non-negative experiments: 
ZEROS 1, SIZE 6: ~6.643 iterations
ZEROS 2, SIZE 6: ~7.317 iterations
ZEROS 3, SIZE 6: ~7.883 iterations
ZEROS 4, SIZE 6: ~8.562 iterations
ZEROS 5, SIZE 6: ~9.429 iterations
ZEROS 6, SIZE 6: ~10.325 iterations
ZEROS 7, SIZE 6: ~94.862 iterations

ZEROS 1, SIZE 7: ~6.18 iterations
ZEROS 2, SIZE 7: ~6.586 iterations
ZEROS 3, SIZE 7: ~6.878 iterations
ZEROS 4, SIZE 7: ~7.338 iterations
ZEROS 5, SIZE 7: ~7.659 iterations
ZEROS 6, SIZE 7: ~8.088 iterations
ZEROS 7, SIZE 7: ~8.577 iterations

ZEROS 1, SIZE 8: ~5.782 iterations
ZEROS 2, SIZE 8: ~5.998 iterations
ZEROS 3, SIZE 8: ~6.247 iterations
ZEROS 4, SIZE 8: ~6.534 iterations
ZEROS 5, SIZE 8: ~6.758 iterations
ZEROS 6, SIZE 8: ~7.072 iterations
ZEROS 7, SIZE 8: ~7.278 iterations

ZEROS 1, SIZE 9: ~5.485 iterations
ZEROS 2, SIZE 9: ~5.677 iterations
ZEROS 3, SIZE 9: ~5.82 iterations
ZEROS 4, SIZE 9: ~5.988 iterations
ZEROS 5, SIZE 9: ~6.181 iterations
ZEROS 6, SIZE 9: ~6.356 iterations
ZEROS 7, SIZE 9: ~6.498 iterations

...
```

Из эксперимента видим, что у бОльших размеров подобный эффект слабо заметен. Возможно, из-за того что матицы стали больше, они стали менее чувствительны к увеличению нулевых элементов, и эффект был сильно заметен на `5` исключительно из-за маленького размера. Это также коррелирует с тем, что мы получили в самом первом эксперименте с положительными матрицами: с ростом матриц итераций в среднем становилось все меньше.

У размеров `8` и `9` видим рост количества итераций. Также никаких скачков на количествах, меньших размера, не наблюдаем.


### Слабые возмущения

Рассмотрим разницу в количестве итераций у неотрицательной матрицы до и после возмущения. Генерировать будем аналогично первому эксперименту в блоке с неотрицательными матрицами, а возмущать будем матрицей, у которой на всех позициях стоит `0.0001`

```console
...

Non-negative experiments with epsilon: 
ZEROS 1, SIZE 5: ~7.426 / 7.425 iterations
ZEROS 2, SIZE 5: ~8.556 / 8.554 iterations
ZEROS 3, SIZE 5: ~10.137 / 10.132 iterations
ZEROS 4, SIZE 5: ~171.632 / 11.988 iterations
ZEROS 5, SIZE 5: ~1533.37 / 17.233 iterations
ZEROS 6, SIZE 5: ~3195.05 / 23.806 iterations
ZEROS 7, SIZE 5: ~6397.46 / 32.934 iterations

...
```

Как видим, возмущение значительно ускорило сходимость (на несколько порядков). Из чего мы делаем вывод, что процесс Синкхорна очень чувствителен к нулям. Более того, мы можем вывести следующее: если мы готовы пожертвовать точностью, то мы можем слегка возмутить матрицу, чтобы избавиться от ненулевых элементов и получить желаемый результат за меньшее количество итераций.
